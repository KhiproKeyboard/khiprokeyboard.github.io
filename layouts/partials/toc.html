{{ if .TableOfContents }}
<nav class="toc w-80 hidden lg:block flex-shrink-0 mb-0">
    <div class="bg-white dark:bg-dark-secondary rounded-2xl shadow-lg flex flex-col sticky top-0">
        <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex-shrink-0">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2 flex items-center">
                <i class="fas fa-list mr-2 text-primary dark:text-dark-primary"></i>
                সূচিপত্র
            </h3>
        </div>
        <div class="toc-content flex-1 overflow-y-auto p-6">
            <div class="prose prose-sm dark:prose-invert max-w-none">
                {{ .TableOfContents | safeHTML }}
            </div>
        </div>
    </div>
</nav>

<!-- Mobile TOC Toggle Button Container -->
<div class="lg:hidden sticky top-20 z-40 h-0 pointer-events-none">
    <button id="toc-mobile-toggle" class="absolute right-4 top-4 bg-primary dark:bg-dark-primary text-white p-3 rounded-full shadow-lg hover:bg-primary-dark dark:hover:bg-dark-primary/80 transition-all duration-200 backdrop-blur-sm pointer-events-auto">
        <i class="fas fa-list text-lg"></i>
        <span class="sr-only">সূচিপত্র খুলুন</span>
    </button>
</div>

<!-- Mobile TOC Overlay -->
<div id="toc-mobile-overlay" class="lg:hidden fixed inset-0 bg-black bg-opacity-50 z-40 opacity-0 invisible transition-all duration-300"></div>

<!-- Mobile TOC Sheet -->
<div id="toc-mobile-sheet" class="lg:hidden fixed top-0 left-0 bottom-0 w-80 max-w-[85vw] bg-white dark:bg-dark-secondary shadow-2xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out">
    <div class="h-full flex flex-col">
        <!-- Header -->
        <div class="p-6 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between flex-shrink-0">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center">
                <i class="fas fa-list mr-2 text-primary dark:text-dark-primary"></i>
                সূচিপত্র
            </h3>
            <button id="toc-mobile-close" class="p-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-colors">
                <i class="fas fa-times text-lg"></i>
            </button>
        </div>
        
        <!-- Content -->
        <div class="flex-1 overflow-y-auto p-6">
            <div class="prose prose-sm dark:prose-invert max-w-none">
                {{ .TableOfContents | safeHTML }}
            </div>
        </div>
    </div>
</div>

<style>
/* TOC styles - colors managed by /css/colors.css */
.toc .prose ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
}

.toc .prose ul ul {
    padding-left: 1rem;
    margin-top: 0.25rem;
}

.toc .prose li {
    margin: 0.25rem 0;
}

.toc .prose a {
    display: block;
    padding: 0.375rem 0.75rem;
    border-radius: 0.5rem;
    text-decoration: none;
    font-size: 0.875rem;
    line-height: 1.25rem;
    transition: all 0.2s ease;
    border-left: 3px solid transparent;
}

/* TOC Sidebar Styles */
@media (min-width: 1024px) {
    .toc {
        width: 20rem;
        max-height: 90vh;
    }
    
    .toc-content {
        overflow-y: auto;
        max-height: calc(90vh - 5rem);
    }
    
    /* Custom scrollbar for TOC */
    .toc-content::-webkit-scrollbar {
        width: 6px;
    }
    
    .toc-content::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 3px;
    }
    
    .dark .toc-content::-webkit-scrollbar-track {
        background: #374151;
    }
    
    .toc-content::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
    }
    
    .dark .toc-content::-webkit-scrollbar-thumb {
        background: #6b7280;
    }
    
    .toc-content::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
    }
    
    .dark .toc-content::-webkit-scrollbar-thumb:hover {
        background: #9ca3af;
    }
}

/* Mobile TOC Sheet Styles */
@media (max-width: 1023px) {
    #toc-mobile-toggle {
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
    }
    
    #toc-mobile-sheet.open {
        transform: translateX(0);
    }
    
    #toc-mobile-overlay.open {
        opacity: 1;
        visibility: visible;
    }
    
    /* Improve mobile TOC content spacing */
    #toc-mobile-sheet .prose a {
        padding: 0.5rem 0.75rem;
        margin: 0.125rem 0;
        font-size: 0.875rem;
        line-height: 1.4;
    }
    
    #toc-mobile-sheet .prose ul ul a {
        padding-left: 1.5rem;
        font-size: 0.8125rem;
    }
    
    #toc-mobile-sheet .prose ul ul ul a {
        padding-left: 2.25rem;
        font-size: 0.75rem;
    }
    
    /* Better touch targets for mobile */
    #toc-mobile-sheet .prose a {
        min-height: 44px;
        display: flex;
        align-items: center;
    }
    
    /* Custom scrollbar for mobile TOC */
    #toc-mobile-sheet .prose::-webkit-scrollbar {
        width: 4px;
    }
    
    #toc-mobile-sheet .prose::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 2px;
    }
    
    .dark #toc-mobile-sheet .prose::-webkit-scrollbar-track {
        background: #374151;
    }
    
    #toc-mobile-sheet .prose::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 2px;
    }
    
    .dark #toc-mobile-sheet .prose::-webkit-scrollbar-thumb {
        background: #6b7280;
    }
}

/* Small mobile devices */
@media (max-width: 480px) {
    #toc-mobile-sheet {
        width: 100vw;
        max-width: 100vw;
    }
    
    #toc-mobile-toggle {
        right: 16px;
        padding: 0.625rem;
    }
    
    #toc-mobile-sheet .prose a {
        font-size: 0.8125rem;
        padding: 0.625rem 0.75rem;
    }
}
</style>
{{ end }}
