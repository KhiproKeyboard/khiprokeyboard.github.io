{{- $text := . -}}
{{- /* Bengali to English transliteration map */ -}}
{{- $bengaliMap := dict "অ" "a" "আ" "a" "ই" "i" "ঈ" "i" "উ" "u" "ঊ" "u" "ঋ" "ri" "এ" "e" "ঐ" "oi" "ও" "o" "ঔ" "ou" "ক" "k" "খ" "kh" "গ" "g" "ঘ" "gh" "ঙ" "ng" "চ" "c" "ছ" "ch" "জ" "j" "ঝ" "jh" "ঞ" "ny" "ট" "t" "ঠ" "th" "ড" "d" "ঢ" "dh" "ণ" "n" "ত" "t" "থ" "th" "দ" "d" "ধ" "dh" "ন" "n" "প" "p" "ফ" "f" "ব" "b" "ভ" "bh" "ম" "m" "য" "y" "র" "r" "ল" "l" "শ" "sh" "ষ" "sh" "স" "s" "হ" "h" "ড়" "r" "ঢ়" "rh" "য়" "y" "ৎ" "t" "ং" "ng" "ঃ" "h" "ঁ" "n" -}}
{{- $bengaliNumbers := dict "০" "0" "১" "1" "২" "2" "৩" "3" "৪" "4" "৫" "5" "৬" "6" "৭" "7" "৮" "8" "৯" "9" -}}

{{- /* Common Bengali words mapping */ -}}
{{- $bengaliWords := dict
    "ক্ষিপ্র" "khipro"
    "ইনস্টলেশন" "installation"
    "ইনস্টল" "install"
    "কিবোর্ড" "keyboard"
    "গাইড" "guide"
    "লিনাক্স" "linux"
    "সিস্টেম" "system"
    "উইন্ডোজ" "windows"
    "ম্যাক" "mac"
    "সেটআপ" "setup"
    "কনফিগারেশন" "configuration"
    "ডাউনলোড" "download"
    "ভার্শন" "version"
    "টেস্টিং" "testing"
    "প্রি-রিলিজ়" "pre-release"
    "কমিউনিটি" "community"
    "সাপোর্ট" "support"
    "ডকুমেন্টেশন" "documentation"
    "টিউটোরিয়াল" "tutorial"
    "ফিচার" "feature"
    "আপডেট" "update"
    "বাগ" "bug"
    "ফিক্স" "fix"
    "রিলিজ" "release"
    "নোট" "note"
    "পরিচিতি" "introduction"
    "শুরু" "start"
    "উদাহরণ" "example"
    "প্রয়োজনীয়" "required"
    "অপশনাল" "optional"
    "সুবিধা" "benefit"
    "সমস্যা" "problem"
    "সমাধান" "solution"
    "পদ্ধতি" "method"
    "নির্দেশিকা" "guideline"
    "চেক" "check"
    "যাচাই" "verify"
    "নিশ্চিত" "confirm"
    "ব্যবহার" "use"
    "অ্যাপ্লিকেশন" "application"
    "সফটওয়্যার" "software"
    "টুল" "tool"
    "ইউটিলিটি" "utility"
    "সেটিংস" "settings"
    "অপশন" "option"
    "মেনু" "menu"
    "বাটন" "button"
    "ক্লিক" "click"
    "ডাবল" "double"
    "রাইট" "right"
    "লেফ্ট" "left"
    "সেন্টার" "center"
    "টপ" "top"
    "বটম" "bottom"
    "আইকন" "icon"
    "ইমেজ" "image"
    "ফাইল" "file"
    "ফোল্ডার" "folder"
    "ডিরেক্টরি" "directory"
    "পাথ" "path"
    "লিংক" "link"
    "ইউআরএল" "url"
    "ওয়েবসাইট" "website"
    "পেজ" "page"
    "হোম" "home"
    "ড্যাশবোর্ড" "dashboard"
    "প্রোফাইল" "profile"
    "অ্যাকাউন্ট" "account"
    "লগইন" "login"
    "লগআউট" "logout"
    "সাইনআপ" "signup"
    "রেজিস্টার" "register"
    "ফরগেট" "forget"
    "পাসওয়ার্ড" "password"
    "ইউজার" "user"
    "নাম" "name"
    "ইমেইল" "email"
    "ফোন" "phone"
    "ঠিকানা" "address"
    "তথ্য" "information"
    "বিবরণ" "description"
    "বিস্তারিত" "details"
    "তালিকা" "list"
    "আইটেম" "item"
    "বিষয়" "topic"
    "বিভাগ" "section"
    "অধ্যায়" "chapter"
    "অনুচ্ছেদ" "paragraph"
    "লাইন" "line"
    "শব্দ" "word"
    "বর্ণ" "character"
    "বর্ণমালা" "alphabet"
    "ব্যাকরণ" "grammar"
    "অর্থ" "meaning"
    "অনুবাদ" "translation"
    "ডিকশনারি" "dictionary"
    "ভাষা" "language"
    "বাংলা" "bangla"
    "ইংরেজি" "english"
    "হিন্দি" "hindi"
    -}}

{{- /* Step 1: Replace HTML tags */ -}}
{{- $clean := replaceRE "<[^>]*>" "" $text -}}

{{- /* Step 2: Replace common Bengali words */ -}}
{{- range $key, $value := $bengaliWords -}}
  {{- $clean = replaceRE (printf "\\b%s\\b" $key) $value $clean -}}
{{- end -}}

{{- /* Step 3: Replace Bengali numbers */ -}}
{{- range $key, $value := $bengaliNumbers -}}
  {{- $clean = replaceRE $key $value $clean -}}
{{- end -}}

{{- /* Step 4: Transliterate remaining Bengali characters */ -}}
{{- range $key, $value := $bengaliMap -}}
  {{- $clean = replaceRE $key $value $clean -}}
{{- end -}}

{{- /* Step 5: Clean up and create slug */ -}}
{{- $clean = replaceRE "\\s+" "-" $clean -}}
{{- $clean = replaceRE "[^a-zA-Z0-9-]+" "" $clean -}}
{{- $clean = replaceRE "-+" "-" $clean -}}
{{- $clean = replaceRE "^-+" "" $clean -}}
{{- $clean = replaceRE "-+$" "" $clean -}}
{{- $clean = lower $clean -}}

{{- /* Step 6: If result is empty or too short, use a timestamp */ -}}
{{- if or (eq $clean "") (lt (len $clean) 2) -}}
  {{- $clean = printf "section-%s" (now.Unix) -}}
{{- end -}}

{{- $clean -}}