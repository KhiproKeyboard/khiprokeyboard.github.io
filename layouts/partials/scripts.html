<script>
    // FAQ Accordion functionality
    document.addEventListener('DOMContentLoaded', function() {
        const faqItems = document.querySelectorAll('.faq-item');
        
        faqItems.forEach(item => {
            const question = item.querySelector('.faq-question');
            const answer = item.querySelector('.faq-answer');
            const icon = question.querySelector('i');
            
            question.addEventListener('click', function() {
                // Close all other FAQs
                faqItems.forEach(otherItem => {
                    if (otherItem !== item) {
                        const otherAnswer = otherItem.querySelector('.faq-answer');
                        const otherIcon = otherItem.querySelector('.faq-question i');
                        otherAnswer.classList.add('hidden');
                        otherIcon.style.transform = 'rotate(0deg)';
                    }
                });
                
                // Toggle current FAQ
                answer.classList.toggle('hidden');
                if (answer.classList.contains('hidden')) {
                    icon.style.transform = 'rotate(0deg)';
                } else {
                    icon.style.transform = 'rotate(180deg)';
                }
            });
        });

        // Tab functionality for homepage
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabPanes = document.querySelectorAll('.tab-pane');

        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                const targetTab = this.getAttribute('data-tab');
                
                // Remove active class from all buttons and panes
                tabButtons.forEach(btn => {
                    btn.classList.remove('active', 'border-primary', 'text-primary');
                    btn.classList.add('border-transparent', 'text-gray-500');
                    btn.setAttribute('aria-selected', 'false');
                });
                
                tabPanes.forEach(pane => {
                    pane.classList.add('hidden');
                    pane.classList.remove('active');
                });
                
                // Add active class to clicked button and corresponding pane
                this.classList.add('active', 'border-primary', 'text-primary');
                this.classList.remove('border-transparent', 'text-gray-500');
                this.setAttribute('aria-selected', 'true');
                
                const targetPane = document.getElementById(targetTab);
                if (targetPane) {
                    targetPane.classList.remove('hidden');
                    targetPane.classList.add('active');
                }
            });
        });

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // TOC functionality
        const tocLinks = document.querySelectorAll('.toc a, #toc-mobile-sheet .prose a');
        const tocMobileToggle = document.getElementById('toc-mobile-toggle');
        const tocMobileSheet = document.getElementById('toc-mobile-sheet');
        const tocMobileOverlay = document.getElementById('toc-mobile-overlay');
        const tocMobileClose = document.getElementById('toc-mobile-close');

        // No positioning needed - using CSS sticky positioning

        // Mobile TOC toggle
        if (tocMobileToggle && tocMobileSheet && tocMobileOverlay) {
            tocMobileToggle.addEventListener('click', function() {
                tocMobileSheet.classList.add('open');
                tocMobileOverlay.classList.add('open');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            });

            // Close mobile TOC
            function closeMobileTOC() {
                tocMobileSheet.classList.remove('open');
                tocMobileOverlay.classList.remove('open');
                document.body.style.overflow = ''; // Restore scrolling
            }

            // Close button
            if (tocMobileClose) {
                tocMobileClose.addEventListener('click', closeMobileTOC);
            }

            // Overlay click to close
            tocMobileOverlay.addEventListener('click', closeMobileTOC);

            // Close on escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && tocMobileSheet.classList.contains('open')) {
                    closeMobileTOC();
                }
            });
        }

        // TOC scroll spy
        function updateTOC() {
            const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
            let currentHeading = null;
            
            headings.forEach(heading => {
                const rect = heading.getBoundingClientRect();
                if (rect.top <= 100 && rect.bottom >= 0) {
                    currentHeading = heading;
                }
            });
            
            tocLinks.forEach(link => {
                link.classList.remove('active');
                if (currentHeading && link.getAttribute('href') === '#' + currentHeading.id) {
                    link.classList.add('active');
                }
            });
        }

        // TOC smooth scrolling
        tocLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href').substring(1);
                const target = document.getElementById(targetId);
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                    // Close mobile TOC after clicking
                    if (tocMobileSheet && tocMobileSheet.classList.contains('open')) {
                        tocMobileSheet.classList.remove('open');
                        tocMobileOverlay.classList.remove('open');
                        document.body.style.overflow = '';
                    }
                }
            });
        });

        // Update TOC on scroll
        if (tocLinks.length > 0) {
            window.addEventListener('scroll', updateTOC);
            updateTOC(); // Initial call
        }


        // Navigation active state removed - only hover effects remain
    });

    // External links handler - make all external links open in new tabs
    const links = document.querySelectorAll('a[href]');
    
    links.forEach(function(link) {
        const href = link.getAttribute('href');
        
        // Check if it's an external link (starts with http/https and not the current domain)
        if (href && (href.startsWith('http://') || href.startsWith('https://'))) {
            const currentDomain = window.location.hostname;
            try {
                const linkDomain = new URL(href).hostname;
                
                // If it's a different domain, make it open in new tab
                if (linkDomain !== currentDomain) {
                    link.setAttribute('target', '_blank');
                    link.setAttribute('rel', 'noopener noreferrer');
                }
            } catch (e) {
                // If URL parsing fails, assume it's external and add target="_blank"
                link.setAttribute('target', '_blank');
                link.setAttribute('rel', 'noopener noreferrer');
            }
        }
    });
</script>
